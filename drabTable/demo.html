<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>无标题文档</title>
        <script src="jquery.min.js"></script>
        <style>
		td{color:#999}
        th{ cursor: move;line-height: 34px;min-width:150px;}
        .createDivBg{ position: fixed;top: 0;bottom: 0;left: 0;right: 0;z-index: 10000;cursor: move;-moz-user-select:none;-webkit-user-select: none;-o-user-select: none;-ms-user-select:none}
        .createDiv{ border: 1px dotted #ccc;height: 34px;line-height: 34px;background:#eee;position: fixed;z-index:100000}
        </style>
    </head>

    <body>
      <div style="">
        <div class="Report">
      <table class="" border="1" cellspacing="0">
        <thead>
          <tr>
            <th value="1">公司名称</th>
            <th value="2">订单号</th>
            <th value="3">操作日期</th>
            <th value="4">PNR</th>
            <th value="5">乘客英文名</th>
            <th value="6">乘客类型</th>
            <th value="7">证件类型</th>
            <th value="8">证件号</th>
            <th value="9">乘客手机号码</th>
            <th value="10">票面价</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>蓝城房产建设管理集团有限公司</td><td>FA20160801144605983</td><td>2016-08-02</td><td>HY59C0</td><td></td><td>成人</td><td>身份证</td><td>330102196709050315</td><td>13705819983</td><td>-940.00</td></tr>
          <tr><td>东芝信息机器（杭州）有限公司</td><td>FA20160729123124926</td><td>2016-08-02</td><td>KTFW44</td><td></td><td>成人</td><td>身份证</td><td>36043019820211171X</td><td>13588837340</td><td>0.00</td></tr>
          <tr><td>东芝信息机器（杭州）有限公司</td><td>FA20160729123124926</td><td>2016-08-02</td><td>KTFW44</td><td></td><td>成人</td><td>身份证</td><td>36043019820211171X</td><td>13588837340</td><td>0.00</td></tr>
          <tr><td>东芝信息机器（杭州）有限公司</td><td>FA20160729123124926</td><td>2016-08-02</td><td>KTFW44</td><td></td><td>成人</td><td>身份证</td><td>36043019820211171X</td><td>13588837340</td><td>0.00</td></tr>
          <tr><td>东芝信息机器（杭州）有限公司</td><td>FA20160729123124926</td><td>2016-08-02</td><td>KTFW44</td><td></td><td>成人</td><td>身份证</td><td>36043019820211171X</td><td>13588837340</td><td>0.00</td></tr>
          <tr><td>东芝信息机器（杭州）有限公司</td><td>FA20160729123124926</td><td>2016-08-02</td><td>KTFW44</td><td></td><td>成人</td><td>身份证</td><td>36043019820211171X</td><td>13588837340</td><td>0.00</td></tr>
          <tr><td>东芝信息机器（杭州）有限公司</td><td>FA20160729123124926</td><td>2016-08-02</td><td>KTFW44</td><td></td><td>成人</td><td>身份证</td><td>36043019820211171X</td><td>13588837340</td><td>0.00</td></tr>
          <tr><td>东芝信息机器（杭州）有限公司</td><td>FA20160729123124926</td><td>2016-08-02</td><td>KTFW44</td><td></td><td>成人</td><td>身份证</td><td>36043019820211171X</td><td>13588837340</td><td>0.00</td></tr>
          <tr><td>东芝信息机器（杭州）有限公司</td><td>FA20160729123124926</td><td>2016-08-02</td><td>KTFW44</td><td></td><td>成人</td><td>身份证</td><td>36043019820211171X</td><td>13588837340</td><td>0.00</td></tr>
          <tr><td>东芝信息机器（杭州）有限公司</td><td>FA20160729123124926</td><td>2016-08-02</td><td>KTFW44</td><td></td><td>成人</td><td>身份证</td><td>36043019820211171X</td><td>13588837340</td><td>0.00</td></tr>
          <tr><td>东芝信息机器（杭州）有限公司</td><td>FA20160729123124926</td><td>2016-08-02</td><td>KTFW44</td><td></td><td>成人</td><td>身份证</td><td>36043019820211171X</td><td>13588837340</td><td>0.00</td></tr>
          <tr><td>东芝信息机器（杭州）有限公司</td><td>FA20160729123124926</td><td>2016-08-02</td><td>KTFW44</td><td></td><td>成人</td><td>身份证</td><td>36043019820211171X</td><td>13588837340</td><td>0.00</td></tr>
          <tr><td>东芝信息机器（杭州）有限公司</td><td>FA20160729123124926</td><td>2016-08-02</td><td>KTFW44</td><td></td><td>成人</td><td>身份证</td><td>36043019820211171X</td><td>13588837340</td><td>0.00</td></tr>
          <tr><td>东芝信息机器（杭州）有限公司</td><td>FA20160729123124926</td><td>2016-08-02</td><td>KTFW44</td><td></td><td>成人</td><td>身份证</td><td>36043019820211171X</td><td>13588837340</td><td>0.00</td></tr>
          <tr><td>东芝信息机器（杭州）有限公司</td><td>FA20160729123124926</td><td>2016-08-02</td><td>KTFW44</td><td></td><td>成人</td><td>身份证</td><td>36043019820211171X</td><td>13588837340</td><td>0.00</td></tr>
        </tbody>
      </table>
        </div>
      </div>


    </body>
</html>
<script>
$(function(){
  var d1=new dragTable();
  d1.init();
})


function dragTable() {
  this.disX = 0; // 相对按下的位置移动的距离
  this.outX = 0; // 鼠标按下的点到大盒子边上的距离
  this.lanX = 0; // 拖动到的位置
  this.$createDiv = null;
  this.$createDivBg = null;
  this.clickEv = null;
  this.set = {
    tabel: '.Report'
  }
}

dragTable.prototype.init = function(opt) {
  $.extend(this.set, opt);
  this.$createDiv = $('<div class="createDiv"></div>');
  this.$createDivBg = $('<div class="createDivBg"></div>'); // 防止复制页面的文字；
  this.events();
}
dragTable.prototype.events = function() {
  var $th = $(this.set.tabel).find('th');
  var that = this;
  $(document).on('mousedown',this.set.tabel +' th',function(e){
    that.clickEv = this;
    that.mousedown(this,e);
    that.$createDivBg.show();
  });
  $(document).on('mouseup',this.set.tabel +' th,.createDiv,.createDivBg',function(e){
    that.mouseup(this,e);
  })
}
dragTable.prototype.mousedown = function(that, e){
  $('body').append(this.$createDiv,this.$createDivBg);
  this.$createDiv.html($(that).html()).hide();

  this.outX = e.pageX - $(that).offset().left;
  var initX = e.pageX;
  var that = this;
  $(document).on('mousemove', function (ev) {
      that.mousemove(that, initX, ev);
  });
}

dragTable.prototype.mousemove=function(that, initX, ev){
  this.disX = ev.pageX - initX;
  this.lanX = ev.pageX;
  this.$createDiv.css({top:ev.pageY-20,left:ev.pageX-10});
  this.getCurrentTh('move');
  Math.abs(this.disX)>4?this.$createDiv.show():this.$createDiv.hide();
}

dragTable.prototype.mouseup=function(that, ev){
  $(document).unbind('mousemove');
  this.resetTable();
}

dragTable.prototype.resetTable = function(){
  this.$createDiv.remove();
  this.$createDivBg.remove();
  this.getCurrentTh('up');
  this.lanX = 0;
  this.disX = 0; // 重置disX
  this.showBorder('all',{'border-color':'#d8d8d8'});
}

dragTable.prototype.getCurrentTh = function(type){
  var that = this;
  $(this.set.tabel +' th').each(function (index,item){
    var l = $(item).offset().left;
    var r = $(item).offset().left + $(item).width();

    if(that.lanX > l && that.lanX < r){
      that.showBorder(index,{'border-color':'#d8d8d8'});
      if(that.disX>4) { // 右
        that.showBorder(index,{'border-right':'2px solid red'});
        type=='up'? that.setThTd(index,'after') :'';
      }
      if(that.disX<-4){ // 左边
        that.showBorder(index,{'border-left':'2px solid red'});
        type=='up'? that.setThTd(index,'before') :'';
      }
    }else{
      that.showBorder(index,{'border-color':'#d8d8d8'})
    }
  })
}

dragTable.prototype.setThTd = function(newsindex,type){
  var oldIndex = $(this.clickEv).index();

  var $th = $(this.set.tabel +' th').eq(oldIndex);
  $(this.set.tabel +' th').eq(newsindex)[type]($th.clone());
  $th.remove();
  $('.Report tbody tr').each(function (index, tdelement) {
      var $td = $(tdelement).find('td').eq(oldIndex);
      $(tdelement).find('td').eq(newsindex)[type]($td.clone());
      $td.remove();
  });
}

dragTable.prototype.showBorder = function(newsindex,css){
  if(newsindex == 'all'){
    $(this.set.tabel +' th').css(css);
    $(this.set.tabel +' td').css(css);
    return;
  }
  $(this.set.tabel +' th').eq(newsindex).css(css)
  $('.Report tbody tr').each(function (index, tdelement) {
      $(tdelement).find('td').eq(newsindex).css(css);
  });
}
